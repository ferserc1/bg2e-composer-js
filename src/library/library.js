
app.addDefinitions(() => {
    app.library = app.library || {};

    function initializeLibrary() {
        this._data = {
            id:"$root$",
            name:"root",
            type:"group",
            children:[
                {
                    type:"group",
                    id:"materials_group",
                    name:"Materials",
                    icon:"",
                    children:[
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        },
                        {
                            type:"material",
                            id:"mat1",
                            name:"Material 1",
                            icon:"",
                            materialModifier: {
                                "diffuseR": 0.9,
                                "diffuseG": 0.9,
                                "diffuseB": 0.9,
                                "diffuseA": 1,
                                "specularR": 1,
                                "specularG": 1,
                                "specularB": 1,
                                "specularA": 1,
                                "shininess": 0,
                                "lightEmission": 0,
                                "texture": "AAL40BK.jpg",
                                "textureOffsetX": 0,
                                "textureOffsetY": 0,
                                "textureScaleX": 1,
                                "textureScaleY": 1,
                                "normalMap": "00 Normal Map.jpg",
                                "normalMapOffsetX": 0,
                                "normalMapOffsetY": 0,
                                "normalMapScaleX": 16,
                                "normalMapScaleY": 16,
                                "alphaCutoff": 0.5,
                                "shininessMask": "",
                                "shininessMaskChannel": 0,
                                "invertShininessMask": 0
                            },
                            metadata: {}
                        }
                    ],
                    metadata:{}
                },
                {
                    type:"group",
                    id:"models",
                    name:"Models group",
                    icon:"",
                    children:[
                        {
                            type: "model",
                            id: "FAARLA00000",
                            name: "Módulo A",
                            icon: "FA_ARIANNE_LOVE_FAARLA00000.jpg",
                            file: "ARIANNE_L_A/ARIANNE_L_A.vwglb",
                            metadata: {
                                dock: "left,right",
                                group: "T3:T3,T4"
                            },
                            folderName: "ARIANNE_L_A"
						}
                    ],
                    metadata:{}
                },
                {
                    type:"group",
                    id:"subgroups",
                    name:"Subgroups",
                    icon:"",
                    children:[
                        {
                            type: "group",
                            id: "sg1",
                            name: "subgroup 1",
                            metadata: {},
                            children: [
                                {
                                    type: "group",
                                    id: "sg2",
                                    name: "subgroup 2",
                                    metadata: {},
                                    children: [
                                        {
                                            type: "group",
                                            id: "sg3",
                                            name: "subgroup 3",
                                            metadata: {},
                                            children: [
                                                {
                                                    type: "group",
                                                    id: "sg4",
                                                    name: "subgroup 4",
                                                    metadata: {},
                                                    children: [
                                                        
                                                    ]
                                                }
                                            ]
                                        }        
                                    ]
                                }        
                            ]
						}
                    ],
                    metadata:{}
                }
            ]
        };
        this._currentNode = this._data;
        buildParents(this._data);
    }

    // Generate the "parent" attribute in the node
    // children, if the node is a group
    function buildParents(node) {
        if (node.children) {
            node.children.forEach((child) => {
                child.parent = node;
                buildParents(child);
            });
        }
    }

    // Clear the node "parent" attribute in the node children
    // if the node is a group.
    // Call this function before serialize the data using
    // JSON.stringify to prevent circular references
    function clearParents(node) {
        if (node.children) {
            node.children.forEach((child) => {
                delete child.parent;
                clearParents(child);
            });
        }
    }

    function assertCurrentNodeIntegrity(node=null) {
        node = node || this._currentNode;
        if (this._currentNode.type!=app.library.NodeType.GROUP) {
            throw new Error("Invalid current node in library manager: the current node is not a group");
        }
        else if (!this._currentNode.children) {
            this._currentNode.children = [];
        }
    }

    function findName() {
        let ch = this.currentNode.children;
        let name = "New node";
        let index = 0;
        let buildName = () => { return `${ name } ${ index }`; }

        while(ch.some((child) => child.name==buildName())) ++index;
        return buildName();
    }

    app.library.NodeType = {
        GROUP: "group",
        MODEL: "model",
        MATERIAL: "material"
    };

    class Library {
        constructor() {
            this._filePath = "";
            initializeLibrary.apply(this);
            this._selection = [];
        }

        get filePath() { return this._filePath; }

        get root() { return this._data; }

        get currentNode() { return this._currentNode; }
        set currentNode(node) {
            assertCurrentNodeIntegrity.apply(this);
            assertCurrentNodeIntegrity.apply(this,[node]);
            if (this.contains(node) && node.type=="group") {
                this._currentNode = node;
            }
        }

        get navigator() {
            let result = [];

            function addNavigatorItem(item) {
                if (item.parent) {
                    addNavigatorItem(item.parent);
                }
                result.push(item);
            }

            addNavigatorItem(this.currentNode);

            return result;
        }

        selectNode(node) {
            if (this._selection.indexOf(node)==-1) {
                this._selection.push(node);
            }
            node.selected = true;
        }

        deselectNode(node) {
            let index = this._selection.indexOf(node);
            if (index!=-1) {
                this._selection.splice(index,1);
            }
            node.selected = false;
        }

        toggleSelect(node) {
            node.selected ? this.deselectNode(node) : this.selectNode(node);
        }

        deselectAll() {
            this._selection.forEach((node) => {
                node.selected = false;
            });
            this._selection = [];
        }

        // TODO: manipulation functions: add, delete and sort nodes
        // TODO: Remember to clear the selection when the library structure change
        addNode(type=app.library.NodeType.GROUP) {
            assertCurrentNodeIntegrity.apply(this);
            this.deselectAll();

            let nodeData = {
                type:type,
                id:bg.utils.generateUUID(),
                name:findName.apply(this),
                icon:"",
                metadata:{}
            };

            switch (type) {
            case app.library.NodeType.GROUP:
                nodeData.children = [];
                break;
            case app.library.NodeType.MODEL:
                nodeData.file = "",
                nodeData.folderName = "";
                break;
            case app.library.NodeType.MATERIAL:
                nodeData.materialModifier = {
                    diffuseR:0.9,
                    diffuseG:0.9,
                    diffuseB:0.9,
                    diffuseA:0.9,
                    specularR:1,
                    specularG:1,
                    specularB:1,
                    specularA:1,

                    shininess:0,
                    shininessMask:"",
                    shininessMaskChannel:0,
                    invertShininessMask:false,

                    alphaCutoff:0.5,

                    lightEmission:0,
                    lightEmissionMask:"",
                    lightEmissionMaskChannel:0,
                    invertLightEmissionMask:false,
                    
                    refractionAmount:0,
                    reflectionAmount:0,
                    
                    texture:"",
                    textureOffsetX:0,
                    textureOffsetY:0,
                    textureScaleX:1,
                    textureScaleY:1,

                    lightmap:"",
                    lightmapOffsetX:0,
                    lightmapOffsetY:0,
                    lightmapScaleX:1,
                    lightmapScaleY:1,

                    normalMap:"",
                    normalMapOffsetX:0,
                    normalMapOffsetY:0,
                    normalMapScaleX:1,
                    normalMapScaleY:1,
                    
                    castShadows:true,
                    receiveShadows:true,

                    reflectionMask:0,
                    reflectionMaskChannel:"",
                    invertReflectionMask:0,
                    reflectionMaskInvert:false,
    
                    roughness:0,
                    roughnessMask:"",
                    roughnessMaskChannel:0,
                    invertRoughnessMask:false,
    
                    unlit:false,
                }
                break;
            default:
                throw new Error(`Error creating node: invalid node type ${ type }`);
            }

            this.currentNode.children.push(nodeData);
            buildParents(this._data);
            return nodeData;
        }

        contains(node,parent=null) {
            let result = false;
            if (node==this._data) {
                result = true;
            }
            else if (!parent) {
                result = this.contains(node,this.root);
            }
            else if (parent.children && parent.children.indexOf(node)!=-1) {
                result = true;
            }
            else if (parent.children) {
                parent.children.some((child) => {
                    result = this.contains(node,child);
                    return result;
                });
            }
            return result;
        }

        clear() {
            initializeLibrary.apply(this);
        }

        deserialize(libraryData) {
            if (typeof(libraryData)=="string") {
                libraryData = JSON.parse(libraryData);
            }
            if (libraryData.type!="vwgl::library" || Array.isArray(libraryData.root)) {
                throw new Error("Malformed library");
            }
            this._data.children = libraryData.root;
            this._currentNode = this._data;
            buildParents(this._data);
        }

        serialize(tabulate = false) {
            clearParents(this._data);
            let result = tabulate ? JSON.stringify(this._data,"","\t") : JSON.stringify(this._data);
            buildParents(this._data);
            return result;
        }
    }

    app.library.Library = Library;
});